@page "/datagrid-column-template"
@using Property365.Web.Components.Demos.Data
@using Property365.Web.Components.Demos.Models.Northwind
@using Microsoft.EntityFrameworkCore
@using System.Linq 
@inject NorthwindContext dbContext
@inject DialogService DialogService

<h1>DataGrid <strong>Column Template</strong></h1>

<p>The <strong>Template</strong> allows you to customize the way data is displayed.</p>

<p>Common uses: Record numbering, displaying an image depending on property value, 
    displaying multiple properties in the same column, linking to other pages,
    data formatting and HTML embedding.
</p>

<Property365ComponentContainer Name="DataGrid" Source="DataGridColumnTemplate" Heading="false">
<Property365DataGrid @ref="ordersGrid" AllowFiltering="true" AllowPaging="true" PageSize="5" AllowSorting="true" 
            Data="@orders" TItem="Order">
    <Columns>
        <Property365DataGridColumn Width="50px" TItem="Order" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
            <Template Context="data">
                @(orders.IndexOf(data) + 1)
            </Template>
        </Property365DataGridColumn>
        <Property365DataGridColumn TItem="Order" Property="Employee.LastName" Title="Employee">
            <Template Context="order">
                <Property365Image Path="@order.Employee?.Photo" style="width: 40px; height: 40px; border-radius: 8px; margin-right: 8px; float: left;" />
                <h5 class="mt-1 mb-0">@order.Employee?.FirstName @order.Employee?.LastName</h5>
                <p class="m-0" style="font-size: 0.8em;">@order.Customer?.CompanyName</p>
            </Template>
        </Property365DataGridColumn>
        <Property365DataGridColumn TItem="Order" Property="OrderDate" Title="Order Date" FormatString="{0:d}" />
        <Property365DataGridColumn TItem="Order" Property="Freight" Title="Freight">
            <Template Context="order">
                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", order.Freight)
            </Template>
        </Property365DataGridColumn>
        <Property365DataGridColumn TItem="Order" Property="ShipCountry" Title="ShipCountry" />
        <Property365DataGridColumn Width="160px" TItem="Order" Property="OrderID" Title="Order Details">
            <Template Context="data">
                <Property365Button ButtonStyle="ButtonStyle.Info" Icon="info" Class="m-1" Click=@(() => OpenOrder(data.OrderID)) Text="@data.OrderID.ToString()" />
            </Template>
        </Property365DataGridColumn>
    </Columns>
</Property365DataGrid>
</Property365ComponentContainer>

@code {
    Property365DataGrid<Order> ordersGrid;
    IList<Order> orders;

    async Task OpenOrder(int orderId)
    {
         await DialogService.OpenAsync<DialogCardPage>($"Order {orderId}",
               new Dictionary<string, object>() { { "OrderID", orderId } },
               new DialogOptions() { Width = "700px", Height = "570px" });
    }

    protected override void OnInitialized()
    {
        orders = dbContext.Orders.Include("Customer").Include("Employee").ToList();
    }
}
