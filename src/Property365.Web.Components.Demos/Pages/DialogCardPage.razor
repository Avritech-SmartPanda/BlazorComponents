@page "/dialogcard/{OrderID}"

@using Property365.Web.Components.Demos.Data
@using Property365.Web.Components.Demos.Models.Northwind
@using Microsoft.EntityFrameworkCore

@inject NorthwindContext dbContext
@inject DialogService dialogService


<div class="flex flex-wrap ">
    <div class="lg:w-1/2 pr-4 pl-4 flex">
        <Property365Card Style="width: 100%; overflow: hidden;">
            <h3 class="h5">Contact</h3>
            <div class="flex flex-row">
                <Property365Image Path="@order.Employee?.Photo" Class="rounded-full float-left mt-1 mr-3" Style="width: 90px; height: 90px;" />
                <div>
                    <div>Employee</div>
                    <b>@(order.Employee?.FirstName + " " + order.Employee?.LastName)</b>
                    <div class="mt-3">Company</div>
                    <b>@order.Customer?.CompanyName</b>
                </div>
            </div>
        </Property365Card>
    </div>
    <div class="lg:w-1/2 pr-4 pl-4 flex">
        <Property365Card Style="width: 100%; overflow: hidden;">
            <h3 class="h5">Delivery Information</h3>
            <div class="flex flex-wrap ">
                <div class="relative flex-grow max-w-full flex-1 px-4">
                    <div>Address</div>
                    <b>@(order.ShipAddress), @(order.ShipCity), @(order.ShipCountry)</b>
                    <div class="mt-3">Ship name</div>
                    <b>@(order.ShipName)</b>
                </div>
            </div>
        </Property365Card>
    </div>
</div>
<div class="flex flex-wrap  my-4">
    <div class="md:w-full pr-4 pl-4">
        <Property365Card>
            <h3 class="h5">
                Order @OrderID Details
                <Property365Badge BadgeStyle="BadgeStyle.Secondary" Text=@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", order.Freight)}") Class="float-right"/>
            </h3>
            <Property365DataGrid AllowFiltering="true" AllowPaging="true" AllowSorting="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                        Data="@(orderDetails.Where(o => o.OrderID == OrderID))" TItem="OrderDetail" ColumnWidth="200px" Class="mt-3">
                <Columns>
                    <Property365DataGridColumn TItem="OrderDetail" Property="Quantity" Title="Quantity" />
                    <Property365DataGridColumn TItem="OrderDetail" Property="Order.OrderDate" Title="Order Date" />
                    <Property365DataGridColumn TItem="OrderDetail" Property="Discount" Title="Discount" FormatString="{0:P}" />
                </Columns>
            </Property365DataGrid>
        </Property365Card>
    </div>
</div>
<div class="flex flex-wrap ">
    <div class="md:w-full pr-4 pl-4 text-right">
        <Property365Button Click="@((args) => dialogService.Close(false))" ButtonStyle="ButtonStyle.Secondary" Text="Cancel" Style="width: 120px" Class="mr-1" />
        <Property365Button Click="@((args) => dialogService.Close(true))" Text="OK" Style="width: 120px" />
    </div>
</div>

@code {
    [Parameter] public int OrderID { get; set; }

    Order order;
    IEnumerable<OrderDetail> orderDetails;

    protected override void OnInitialized()
    {
        order = dbContext.Orders.Where(o => o.OrderID == OrderID)
                          .Include("Customer")
                          .Include("Employee").FirstOrDefault();

        orderDetails = dbContext.OrderDetails.Include("Order").ToList();
    }
}
