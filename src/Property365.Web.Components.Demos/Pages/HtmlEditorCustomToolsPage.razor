@page "/html-editor-custom-tools"
@inject DialogService DialogService

<h1>Property365 Blazor HtmlEditor custom tools</h1>
<Property365ComponentContainer Name="HtmlEditor" Source="HtmlEditorCustomTools" Heading="false">
    <div class="row">
        <div class="col-md-4">
            <h3>Custom button</h3>
            <Property365HtmlEditor style="height: 500px; margin-bottom: 1rem;" Execute=@OnExecute>
                <Property365HtmlEditorCustomTool CommandName="InsertToday" Icon="today" Title="Insert today" />
            </Property365HtmlEditor>
        </div>
        <div class="col-md-4">
            <h3>Custom tool with template</h3>
            <Property365HtmlEditor style="height: 500px; margin-bottom: 1rem;">
                <Property365HtmlEditorCustomTool>
                    <Template Context="editor">
                        <Property365DatePicker Change=@(args => OnDateChange(args, editor)) TValue="DateTime" />
                    </Template>
                </Property365HtmlEditorCustomTool>
            </Property365HtmlEditor>
        </div>
        <div class="col-md-4">
            <h3>Custom dialog</h3>
            <Property365HtmlEditor style="height: 500px; margin-bottom: 1rem;" Execute=@OnExecute>
                <Property365HtmlEditorCustomTool CommandName="InsertImageFromList" Icon="attach_file" />
            </Property365HtmlEditor>
        </div>
    </div>
</Property365ComponentContainer>
@code {
    async Task OnExecute(HtmlEditorExecuteEventArgs args)
    {
        if (args.CommandName == "InsertToday")
        {
            await InsertDate(args.Editor, DateTime.Now);
        }

        if (args.CommandName == "InsertImageFromList")
        {
            await InsertImageFromList(args.Editor);
        }
    }

    async Task InsertImageFromList(Property365HtmlEditor editor)
    {
        await editor.SaveSelectionAsync();

        var result = await DialogService.OpenAsync<HtmlEditorCustomDialog>("Select image file"); 

        await editor.RestoreSelectionAsync();

        if (result != null)
        {
            await editor.ExecuteCommandAsync(HtmlEditorCommands.InsertHtml, $"<img style=\"max-width: 100%\" src=\"{result}\">");
        }
    }

    async Task OnDateChange(DateTime? date, Property365HtmlEditor editor)
    {
        if (date != null)
        {
            await InsertDate(editor, date.Value);
        }
    }

    async Task InsertDate(Property365HtmlEditor editor, DateTime date)
    {
        await editor.ExecuteCommandAsync(HtmlEditorCommands.InsertHtml, $"<strong>{date.ToLongDateString()}</strong>");
    }
}